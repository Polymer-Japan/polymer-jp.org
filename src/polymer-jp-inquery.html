<link rel="import" href="../components/polymer/polymer-element.html">
<link rel="import" href="../components/polymer/lib/mixins/gesture-event-listeners.html">
<link rel="import" href="../components/paper-button/paper-button.html">
<link rel="import" href="../components/paper-dialog/paper-dialog.html">
<link rel="import" href="../components/neon-animation/web-animations.html">
<link rel="import" href="../components/neon-animation/neon-animations.html">
<link rel="import" href="../components/paper-input/paper-textarea.html">
<link rel="import" href="../components/paper-input/paper-input.html">
<link rel="import" href="../components/paper-button/paper-button.html">

<dom-module id="polymer-jp-inquery">
  <template>
    <style>
      paper-dialog {
        position: fixed;
        top: 60px;
        right: 0px;
        width: 400px;
        overflow: auto;
      }
      paper-dialog h3 {
        cursor: pointer;
        user-select: none;
      }
      paper-dialog p {
        height: 60vh;
      }
      paper-textarea {
        --paper-input-container-input:{
          min-height: 4em;
        }
      }
    </style>
    
    <paper-dialog opened="[[open]]"
      entry-animation="slide-from-bottom-animation"
      exit-animation="fade-out-animation"
      always-on-top no-cancel-on-outside-click>
      <h3 on-track="_trackDialog">お問い合わせ</h3>
      <paper-input always-float-label label="Title" value="{{_inqueryData.title}}"
        auto-validate required auto-validate error-message="入力必須です!"></paper-input>
      <paper-textarea always-float-label label="Contents" value="{{_inqueryData.contents}}"
        required auto-validate error-message="入力必須です!"></paper-textarea>
      <div class="buttons">
        <paper-button dialog-confirm active="{{open}}">CANCEL</paper-button>
        <paper-button on-tap="_sendInquery">SEND</paper-button>
      </div>
    </paper-dialog>
    
  </template>
  <script>
    class PolymerJpInquery extends Polymer.GestureEventListeners(Polymer.Element) {
      static get is() { return 'polymer-jp-inquery' }
      static get properties() {
        return {
          open: {
            type: Boolean,
            notify: true,
          },
          _inqueryData: {
            type: Object,
            value: {},
          },
        }
      }
      _sendInquery(e) {
        this.dispatchEvent(new CustomEvent('toast-thanks-inq',{bubbles:true, composed:true}));
        this.set('open',false);
        this._inqueryData.created=firebase.firestore.FieldValue.serverTimestamp();
        firebase.firestore().collection('inquiries').add(this._inqueryData).then(_=>this.set('_inqueryData',{}));
      }
      _trackDialog(e) {
        e.stopPropagation();
        e.preventDefault();
        const t = e.target.parentNode;
        t.style.transitionProperty='width,height'
        switch(e.detail.state) {
          case 'start':
            this._tiX = t.offsetLeft - 40;
            this._tiY = t.offsetTop - 23;
            break;
          case 'track':
            t.style.left = (e.detail.dx + this._tiX) + 'px';
            t.style.top  = (e.detail.dy + this._tiY) + 'px';
            break;
        }
      }
    }
    customElements.define(PolymerJpInquery.is, PolymerJpInquery)
  </script>
</dom-module>
